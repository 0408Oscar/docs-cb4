
<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
<head><meta name="description" content="Most functions in the C SDK return an error code of type lcb_error_t . As an application developer, you should be prepared to handle non-successful error codes and treat them appropriately. If the ..."></meta><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta><meta name="copyright" content="(C) Copyright 2005"></meta><meta name="DC.rights.owner" content="(C) Copyright 2005"></meta><meta name="DC.Type" content="concept"></meta><meta name="DC.Title" content="SDK Errors"></meta><meta name="abstract" content="Most functions in the C SDK return an error code of type lcb_error_t. As an application developer, you should be prepared to handle non-successful error codes and treat them appropriately. If the library is not behaving as expected then your first action should be to determine if your application is properly handling (and checking) any error codes returned by the library. Remember that error codes are only significant when there is an error condition!"></meta><meta name="description" content="Most functions in the C SDK return an error code of type lcb_error_t. As an application developer, you should be prepared to handle non-successful error codes and treat them appropriately. If the library is not behaving as expected then your first action should be to determine if your application is properly handling (and checking) any error codes returned by the library. Remember that error codes are only significant when there is an error condition!"></meta><meta name="DC.Relation" scheme="URI" content="exceptions-diagnostics-toplevel.html"></meta><meta name="DC.Format" content="XHTML"></meta><meta name="DC.Identifier" content="concept_vqw_djq_44"></meta><link rel="stylesheet" type="text/css" href="oxygen-webhelp/resources/css/commonltr.css"><!----></link><title>SDK Errors</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta><link rel="stylesheet" type="text/css" href="oxygen-webhelp/resources/css/webhelp_topic.css"><!----></link><link rel="stylesheet" type="text/css" href="oxygen-webhelp/resources/skins/skin.css"><!----></link><script type="text/javascript"><!--
          
          var prefix = "index.html";
          
          --></script><script type="text/javascript" src="oxygen-webhelp/resources/js/jquery-1.8.2.min.js"><!----></script><script type="text/javascript" src="oxygen-webhelp/resources/js/jquery.cookie.js"><!----></script><script type="text/javascript" src="oxygen-webhelp/resources/js/jquery-ui.custom.min.js"><!----></script><script type="text/javascript" src="oxygen-webhelp/resources/js/jquery.highlight-3.js"><!----></script><script type="text/javascript" charset="utf-8" src="oxygen-webhelp/resources/js/webhelp_topic.js"><!----></script></head>
<body onload="highlightSearchTerm()" class="frmBody" id="concept_vqw_djq_44">
<table class="nav"><tbody><tr><td colspan="2"><div id="printlink"><a href="javascript:window.print();" title="Print this page"></a></div><div id="permalink"><a href="#" title="Link to this page"></a></div></td></tr><tr><td width="75%"><a class="navheader_parent_path" href="exceptions-diagnostics-toplevel.html" title="Errors and Diagnostics">Errors and Diagnostics</a></td><td><div class="navheader">
<span class="navparent"><a class="link" href="exceptions-diagnostics-toplevel.html" title="Errors and Diagnostics"><span class="navheader_label">Parent topic</span><span class="navheader_separator">: </span><span class="navheader_linktext">Errors and Diagnostics</span></a></span>  </div></td></tr></tbody></table>

	<h1 class="title topictitle1">SDK Errors</h1>

	
<div class="body conbody"><p class="shortdesc">Most functions in the C SDK return an error code of type <span class="keyword apiname">lcb_error_t</span>.
        As an application developer, you should be prepared to handle non-successful error codes and
        treat them appropriately. If the library is not behaving as expected then your first action
        should be to determine if your application is properly handling (and checking) any error
        codes returned by the library. Remember that error codes are only significant when there is
        an error condition!</p>

        <div class="section"><h2 class="title sectiontitle">SDK Error types</h2>A successful operation is defined by the return code
            of <samp class="ph codeph">LCB_SUCCESS</samp>, while any other code indicates an error condition. You
            can find a full list of error codes in the
                <span class="ph filepath">&lt;libcouchbase/error.h&gt;</span> header.<div class="note note"><span class="notetitle">Note:</span> New applications are
                advised to enable extended error codes by using the
                    <samp class="ph codeph">LCB_CNTL_DETAILED_ERRCODES</samp> setting (see <a class="xref" href="tuning.html#concept_wtt_2jq_44">tuning.html#concept_wtt_2jq_44</a>). Extended error codes are not enabled
                by default to avoid sending older applications error codes that they cannot handle.
                    </div>
<p class="p"><em class="ph i">Data errors</em> (link) include <span class="keyword apiname">LCB_KEY_ENOENT</span>
                (item not found), <span class="keyword apiname">LCB_KEY_EEXISTS</span> (item already exists, or a
                mismatched CAS). You can check if a given error code is a data error by using the
                    <span class="keyword apiname">LCB_EIFDATA</span>
                    macro:</p>
<pre class="pre codeblock">LCB_EIFDATA(LCB_KEY_ENOENT); // true
LCB_EIFDATA(LCB_EINVAL); // false</pre>
<p class="p"><em class="ph i">Transient
                    errors</em> (link) include <span class="keyword apiname">LCB_ETMPFAIL</span> and
                    <span class="keyword apiname">LCB_ETIMEDOUT</span>. You can check if an error code is transient or
                not by using the <span class="keyword apiname">LCB_EIFTMP</span> macro.</p>
<p class="p"><em class="ph i">Network errors</em>
                (link) include <span class="keyword apiname">LCB_NETWORK_ERROR</span>,
                    <span class="keyword apiname">LCB_ECONNREFUSED</span>, <span class="keyword apiname">LCB_ESOCKSHUTDOWN</span>, and
                so on. You can check if an error is a network error by using the
                    <span class="keyword apiname">LCB_EIFNET</span> macro. Use of the <span class="keyword apiname">LCB_EIFNET</span>
                macro is recommended over checking specific error codes because network errors may
                be varied across different operations system and event loop
                implementations.</p>
<div class="p">The <samp class="ph codeph">LCB_EIF_${TYPE}</samp> macros, where
                    <samp class="ph codeph">${TYPE}</samp> represents one of the <samp class="ph codeph">lcb_errflags_t</samp>
                flags, can be used to check whether an error is of a specific type. The following
                example shows how to check the return codes:
                <pre class="pre codeblock language-c"><strong class="hl-keyword" style="color:#7f0055">static</strong> <strong class="hl-keyword" style="color:#7f0055">void</strong> get_callback(lcb_t instance,
  <strong class="hl-keyword" style="color:#7f0055">const</strong> <strong class="hl-keyword" style="color:#7f0055">void</strong> *cookie, lcb_error_t err, <strong class="hl-keyword" style="color:#7f0055">const</strong> lcb_get_resp_t *resp)
{
  <strong class="hl-keyword" style="color:#7f0055">if</strong> (err == LCB_SUCCESS) {
    printf(<span class="hl-string" style="color:#2a00ff">"Successfuly retrieved key!\n"</span>);
  } <strong class="hl-keyword" style="color:#7f0055">else</strong> <strong class="hl-keyword" style="color:#7f0055">if</strong> (LCB_EIFDATA(err)) {
    <strong class="hl-keyword" style="color:#7f0055">switch</strong> (err) {
    <strong class="hl-keyword" style="color:#7f0055">case</strong> LCB_KEY_ENOENT:
      printf(<span class="hl-string" style="color:#2a00ff">"Key not found!\n"</span>);
      <strong class="hl-keyword" style="color:#7f0055">break</strong>;
    <strong class="hl-keyword" style="color:#7f0055">default</strong>:
      printf(<span class="hl-string" style="color:#2a00ff">"Received other unhandled data error\n"</span>);
      <strong class="hl-keyword" style="color:#7f0055">break</strong>;
    }
  } <strong class="hl-keyword" style="color:#7f0055">else</strong> <strong class="hl-keyword" style="color:#7f0055">if</strong> (LCB_EIFTMP(err)) {
    printf(<span class="hl-string" style="color:#2a00ff">"Transient error received. May retry\n"</span>);
  }
}</pre>
</div>
</div>

        <div class="section"><h2 class="title sectiontitle">When to check for errors, and what they mean</h2>
            
            <p class="p">Success and failure depend on the context. A successful return code for one of the
                data operation APIs (for example, <span class="keyword apiname">lcb_store3()</span>) does not mean the
                operation itself succeeded and the key was successfully stored. Rather, it means the
                key was successfully placed inside the libraryâ€™s internal queue. The actual error
                code is delivered as the <span class="keyword apiname">lcb_RESPBASE::rc</span> parameter in the
                operation callback itself (that is, the callback installed with
                    <span class="keyword apiname">lcb_install_callback3()</span>).</p>

            <p class="p">Non-successful error codes received in callbacks are <em class="ph i">usually</em> a result of a
                negative server reply or a network connectivity issue.</p>

            <p class="p">If an error was returned from a scheduling function (e.g.
                    <span class="keyword apiname">lcb_get3())</span>, it may be the result of a bad input (see
                    <span class="keyword apiname">LCB_EIFINPUT</span>). Scheduling functions may also return
                    <span class="keyword apiname">LCB_NOT_SUPPORTED</span> or
                    <span class="keyword apiname">LCB_CLIENT_FEATURE_UNAVAILABLE</span> which suggest that the server
                or the client do not support the given API.</p>

            <p class="p">If a scheduling API returns anything but <samp class="ph codeph">LCB_SUCCESS</samp>, the callback
                for that specific request will <em class="ph i">not</em> be delivered. Conversely, it is guaranteed
                that the callback will always be delivered if the return code for the scheduling
                function is <samp class="ph codeph">LCB_SUCCESS</samp>.</p>

            <div class="p">You can print a textual representation of the error by using
                    <span class="keyword apiname">lcb_strerror</span>. This function is always guaranteed to return a
                valid
                    string<pre class="pre codeblock">lcb_strerror(NULL, LCB_OPTIONS_CONFLICT);</pre>
<div class="note note"><span class="notetitle">Note:</span> The
                    first argument to <span class="keyword apiname">lcb_strerror</span> is ignored and has never been
                    used.</div>
</div>

        </div>

        <div class="section"><h2 class="title sectiontitle">Handling unresponsive servers</h2>
            
            <p class="p">If a server is unresponsive action should be taken to determine the cause and either
                fix the server or fail it over, depending on available replicas and the type of
                problem caused. The client SDK cannot determine if a server is unresponsive and by
                default assumes that any network or server failure is extremely temporary in nature
                and will attempt to reconnect as required.</p>

            <p class="p">If a cluster node is unresponsive and the application determines (through a mechanism
                outside Couchbase) that the node may be unresponsive for some time, it is possible
                to avoid sending operations to that node:</p>

            <div class="p">In Couchbase architecture, keys are mapped to [vBuckets], which in turn are mapped to
                cluster nodes. To avoid sending operations to a specific server, you need to
                retrieve the server index for the key and then the hostname corresponding to that
                index. This is done by using the <em class="ph i">vBucket</em>
                API:<pre class="pre codeblock">bool maybe_skip_host(lcb_t instance,
                     const std::string&amp; key,
                     const std::vector&lt;std::string&gt;&amp; badhosts) {
    lcbvb_CONFIG *vbc;
    lcb_cntl(instance, LCB_CNTL_GET, &amp;vbc);
    int ix, vbtmp;
    lcbvb_map_key(vbc, keybuf, keylen, &amp;vbtmp, &amp;ix);
    if (ix &lt; 0) {
        // Missing node. See next section!
        return false;
    } else {
        std::string hostname = lcbvb_get_hostname(ix);
        for (size_t ii = 0; ii &lt; badhosts.size(); ++ii) {
            if (hostname == badhosts[ii]) {
                return true;
            }
        }
    }
    return false;
}</pre>
</div>

            
            <div class="p">If your application abnormally terminates while invoking a function with the library,
                you may have either encountered a bug or passed the library an invalid pointer. Keep
                in mind the following points:<ul class="ul" id="concept_vqw_djq_44__ul_dyk_2vj_p4">
                    <li class="li">The library is <em class="ph i">not</em> thread safe. While you may use multiple
                            <em class="ph i">lcb_t</em> handles in different threads, you must never access the
                        same handle from multiple threads without using external synchronization
                        functions (such as mutexes).</li>

                    <li class="li">The response structures within the callback are valid <em class="ph i">only</em> in the
                        scope of the callback function itself. This means you must copy the
                        structure (and any contained keys and values) into another location in
                        memory if you wish to use it outside the callback.</li>

                    <li class="li">Callbacks will <em class="ph i">not</em> be invoked if the scheduling function returns a
                        failure status. This means that the following code will result in accessing
                        uninitialized
                        memory:<pre class="pre codeblock language-c"><strong class="hl-keyword" style="color:#7f0055">struct</strong> myresult {
  <strong class="hl-keyword" style="color:#7f0055">char</strong> *value;
  lcb_error_t err;
}
<strong class="hl-keyword" style="color:#7f0055">static</strong> <strong class="hl-keyword" style="color:#7f0055">void</strong> get_callback(lcb_t instance, <strong class="hl-keyword" style="color:#7f0055">int</strong> cbtype, <strong class="hl-keyword" style="color:#7f0055">const</strong> lcb_RESPGET *resp)
{
  <strong class="hl-keyword" style="color:#7f0055">struct</strong> myresult *mr = (<strong class="hl-keyword" style="color:#7f0055">struct</strong> myresult *)resp-&gt;cookie;
  mr-&gt;err = resp-&gt;rc;
  <strong class="hl-keyword" style="color:#7f0055">if</strong> (mr-&gt;err == LCB_SUCCESS) {
    mr-&gt;value = malloc(resp-&gt;nkey + <span class="hl-number">1</span>);
    memcpy(mr-&gt;value, resp-&gt;key, resp-&gt;nkey);
    mr-&gt;value[resp-&gt;nkey] = <span class="hl-string" style="color:#2a00ff">'\0'</span>;
  } <strong class="hl-keyword" style="color:#7f0055">else</strong> {
    mr-&gt;value = NULL;
  }
}

<em class="hl-comment" style="color:#006400">// Some lines later</em>
<strong class="hl-keyword" style="color:#7f0055">struct</strong> myresult mr;
lcb_get3(instance, &amp;mr, &amp;cmd);
lcb_wait(instance);
<strong class="hl-keyword" style="color:#7f0055">if</strong> (mr.value) {
  <em class="hl-comment" style="color:#006400">// If lcb_get() returned an error, this will be uninitialized access!</em>
  <em class="hl-comment" style="color:#006400">// ...</em>
}</pre>
</li>

                </ul>
</div>

            <p class="p">A crash can also be a result of a bug in the library. Sometimes the library will call
                abort when it detects an inconsistent state. If you think you have found a bug in
                the library you should file a bug in our <a class="xref" href="http://www.couchbase.com/issues/browse/CCBC" target="_blank">issue tracker</a>. When filing a bug, please be sure to
                include the library version and any relevant code samples.</p>

        </div>

        <div class="section"><h2 class="title sectiontitle">Diagnosing Issues</h2>
            
            <p class="p">Diagnosing issues can typically be done by enabling logging (see <a class="xref" href="logging-c.html#concept_ff3_2jq_44">Logging</a>).</p>

        </div>

    </div>

<div class="related-links"></div>
<div class="navfooter"><!---->
<span class="navparent"><a class="link" href="exceptions-diagnostics-toplevel.html" title="Errors and Diagnostics"><span class="navheader_label">Parent topic</span><span class="navheader_separator">: </span><span class="navheader_linktext">Errors and Diagnostics</span></a></span>  </div><div class="footer">WebHelp output generated by<a href="http://www.oxygenxml.com" target="_blank"><span class="oXygenLogo"><img src="oxygen-webhelp/resources/img/LogoOxygen100x22.png" alt="Oxygen"></img></span><span class="xmlauthor">XML Author</span></a> - Trial Edition</div>
</body>
</html>