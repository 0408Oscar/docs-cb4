
<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
<head><meta name="description" content="This section will guide you through the process and steps of configuring the client to talk to a variety of cluster setups and options. Connection parameters The client object must first be ..."></meta><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta><meta name="copyright" content="(C) Copyright 2005"></meta><meta name="DC.rights.owner" content="(C) Copyright 2005"></meta><meta name="DC.Type" content="concept"></meta><meta name="DC.Title" content="Managing server connections"></meta><meta name="abstract" content="This section will guide you through the process and steps of configuring the client to talk to a variety of cluster setups and options."></meta><meta name="description" content="This section will guide you through the process and steps of configuring the client to talk to a variety of cluster setups and options."></meta><meta name="DC.Relation" scheme="URI" content="c-intro.html"></meta><meta name="DC.Relation" scheme="URI" content="n1ql-queries.html"></meta><meta name="DC.Relation" scheme="URI" content="handling-errors.html"></meta><meta name="DC.Format" content="XHTML"></meta><meta name="DC.Identifier" content="concept_ppz_lhq_44"></meta><link rel="stylesheet" type="text/css" href="oxygen-webhelp/resources/css/commonltr.css"><!----></link><title>Managing server connections</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta><link rel="stylesheet" type="text/css" href="oxygen-webhelp/resources/css/webhelp_topic.css"><!----></link><link rel="stylesheet" type="text/css" href="oxygen-webhelp/resources/skins/skin.css"><!----></link><script type="text/javascript"><!--
          
          var prefix = "index.html";
          
          --></script><script type="text/javascript" src="oxygen-webhelp/resources/js/jquery-1.8.2.min.js"><!----></script><script type="text/javascript" src="oxygen-webhelp/resources/js/jquery.cookie.js"><!----></script><script type="text/javascript" src="oxygen-webhelp/resources/js/jquery-ui.custom.min.js"><!----></script><script type="text/javascript" src="oxygen-webhelp/resources/js/jquery.highlight-3.js"><!----></script><script type="text/javascript" charset="utf-8" src="oxygen-webhelp/resources/js/webhelp_topic.js"><!----></script></head>
<body onload="highlightSearchTerm()" class="frmBody" id="concept_ppz_lhq_44">
<table class="nav"><tbody><tr><td colspan="2"><div id="printlink"><a href="javascript:window.print();" title="Print this page"></a></div><div id="permalink"><a href="#" title="Link to this page"></a></div></td></tr><tr><td width="75%"><a class="navheader_parent_path" href="c-intro.html" title="C SDK 2.6">C SDK 2.6</a></td><td><div class="navheader">
<span class="navparent"><a class="link" href="c-intro.html" title="C SDK 2.6"><span class="navheader_label">Parent topic</span><span class="navheader_separator">: </span><span class="navheader_linktext">C SDK 2.6</span></a></span>  
<span class="navprev"><a class="link" href="n1ql-queries.html" title="You can perform Couchbase Query Language (N1QL) queries via the C client library."><span class="navheader_label">Previous topic</span><span class="navheader_separator">: </span><span class="navheader_linktext">Working with N1QL queries</span></a></span>  
<span class="navnext"><a class="link" href="handling-errors.html" title="Most operations return an lcb_error_t status code."><span class="navheader_label">Next topic</span><span class="navheader_separator">: </span><span class="navheader_linktext">Handling errors</span></a></span>  </div></td></tr></tbody></table>

 <h1 class="title topictitle1">Managing server connections </h1>

 
 <div class="body conbody"><p class="shortdesc">This section will guide you through the process and steps of configuring the client to
    talk to a variety of cluster setups and options. </p>

    <div class="section" id="concept_ppz_lhq_44__concept_khq_vhq_44"><h2 class="title sectiontitle">Connection parameters</h2>
      
      <p class="p">The client object must first be instantiated using the
        <span class="keyword apiname">lcb_create_st</span>structure. It  contains fields needed to initialize the
        client with the proper parameters to connect to a bucket. The structure contains these
        notable fields: <samp class="ph codeph">connstr</samp> and <samp class="ph codeph">passwd</samp>.</p>

      <p class="p"> The <samp class="ph codeph">connstr</samp> field accepts a specifier known as a <dfn class="term">connection
          string</dfn> that indicates which bucket to connect to and which hosts comprise the
        cluster. The <samp class="ph codeph">passwd</samp><em class="ph i"></em> field should contain your bucket password if your
        bucket has been configured with authentication.</p>

      <div class="p">In the simplest form, initialize your structure like so:
				<pre class="pre codeblock language-c"><strong class="hl-keyword" style="color:#7f0055">struct</strong> lcb_create_st cropts;
memset(&amp;cropts, <span class="hl-number">0</span>, <strong class="hl-keyword" style="color:#7f0055">sizeof</strong> cropts);
cropts.version = <span class="hl-number">3</span>;
cropts.v.v3.connstr = <span class="hl-string" style="color:#2a00ff">"couchbase://localhost/mybucket"</span>;
cropts.v.v3.passwd = <span class="hl-string" style="color:#2a00ff">"topsecret"</span>;</pre>
In
				the example, <samp class="ph codeph">localhost</samp> is a host of your cluster,
					<samp class="ph codeph">mybucket</samp> is the bucket you want to connect to, and
					<samp class="ph codeph">passwd</samp> is the bucket password.</div>

      <p class="p">For increased redundancy, you can specify <em class="ph i">multiple</em> hosts, separated by a semicolon,
        like <samp class="ph codeph">"couchbase://host1.net;host2.net/mybucket"</samp>. Specifying multiple hosts
        allows the library to connect to the cluster as long as any of the hosts specified are
        up.</p>

    </div>

    <div class="section"><h2 class="title sectiontitle">Initializing the client handle</h2>
      
      <div class="p">After the <span class="keyword apiname">lcb_create_st</span> structure has been initialized, you can create
				your instance object - or the opaque handle that represents the connection to your
				bucket:<pre class="pre codeblock language-c">lcb_t instance = NULL;
lcb_error_t err = lcb_create(&amp;instance, &amp;cropts);
<strong class="hl-keyword" style="color:#7f0055">if</strong> (err != LCB_SUCCESS) {
    fprintf(stderr, “Could not create library handle: %s\n”, lcb_strerror(NULL, err));
}</pre>
</div>

      <p class="p">The <span class="keyword apiname">lcb_create()</span> function initializes and allocates a new handle with
        the settings provided inside the <span class="keyword apiname">lcb_create_st</span> object.</p>

      <p class="p">After the handle has been initialized, a connection to the cluster must be scheduled.
				Invoke the <span class="keyword apiname">lcb_connect()</span> call to initiate the connection sequence.
				After the connection is scheduled, you need to wait for the connection to actually
				complete by using the <span class="keyword apiname">lcb_wait()</span> function, which waits for pending
				I/O to complete on behalf of the library. Finally, when lcb_wait() returns, use the
					<span class="keyword apiname">lcb_get_bootstrap_status()</span> function to determine if the connection
				completed successfully or if an error occurred:</p>

      <pre class="pre codeblock language-c">lcb_error_t err;
lcb_connect(instance);
lcb_wait(instance);
err = lcb_get_bootstrap_status(instance);
<strong class="hl-keyword" style="color:#7f0055">if</strong> (err != LCB_SUCCESS) {
  fprintf(stderr, “Couldn’t bootstrap: %s\n”, lcb_strerror(instance, err));
}</pre>

    </div>

   <div class="section"><h2 class="title sectiontitle">Connecting with SSL</h2>
     
     <p class="p">Couchbase Sever features the ability to have clients communicate securely via SSL.</p>

     <p class="p">To use SSL, you need Couchbase Server Enterprise 3.0 or later</p>

     <ol class="ol">
       <li class="li">Obtain the SSL certificate used by the Cluster (...). </li>

				<li class="li">Make the certificate available to the file system of the client host.</li>

       <li class="li">Employ the <samp class="ph codeph">couchbases://</samp> scheme for the <samp class="ph codeph">connstr</samp>
					field.</li>

       <li class="li">Specify the local path to the certificate as the value for the <samp class="ph codeph">certpath</samp>
					field.</li>

     </ol>

     <div class="p">To connect to the <samp class="ph codeph">mybucket</samp> bucket on SSL-enabled Cluster at the node
                10.3.4.33, with the certificate saved as <samp class="ph codeph">/var/cbcert.pem</samp>:
                <pre class="pre codeblock language-c">cropts.v.v3.connstr = <span class="hl-string" style="color:#2a00ff">"couchbases://10.3.4.33/mybucket?certpath=/var/cbcert.pem"</span>;</pre>
</div>

   </div>

  </div>

  <div class="related-links"></div>
<div class="navfooter"><!---->
<span class="navparent"><a class="link" href="c-intro.html" title="C SDK 2.6"><span class="navheader_label">Parent topic</span><span class="navheader_separator">: </span><span class="navheader_linktext">C SDK 2.6</span></a></span>  
<span class="navprev"><a class="link" href="n1ql-queries.html" title="You can perform Couchbase Query Language (N1QL) queries via the C client library."><span class="navheader_label">Previous topic</span><span class="navheader_separator">: </span><span class="navheader_linktext">Working with N1QL queries</span></a></span>  
<span class="navnext"><a class="link" href="handling-errors.html" title="Most operations return an lcb_error_t status code."><span class="navheader_label">Next topic</span><span class="navheader_separator">: </span><span class="navheader_linktext">Handling errors</span></a></span>  </div><div class="footer">WebHelp output generated by<a href="http://www.oxygenxml.com" target="_blank"><span class="oXygenLogo"><img src="oxygen-webhelp/resources/img/LogoOxygen100x22.png" alt="Oxygen"></img></span><span class="xmlauthor">XML Author</span></a> - Trial Edition</div>
</body>
</html>