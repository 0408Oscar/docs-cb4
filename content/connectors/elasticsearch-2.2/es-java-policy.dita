<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="topic_vnw_2zq_t5">
  <title>Java Security Policy Permissions</title> <shortdesc>To get the plugin to work with ElasticSearch 2.1.x, it is necessary to edit the system's
    default <codeph>java.security</codeph> file, which is located in the
      <filepath>%JAVA_HOME%/jre/lib/security</filepath> directory.</shortdesc>
  <body>
    <p>You can either edit this file directly or use the policytool utility, which can be found in
      the <filepath>%JAVA_HOME%/bin</filepath> directory. Note that editing the policy file requires
      root permissions. If you're editing the policy file directly, add the following to the end of
      the file:</p>
    <codeblock>grant codeBase "file:/&lt;path to transport-couchbase plugin install directory&gt;/*" {
      permission javax.security.auth.AuthPermission "modifyPrincipals";
      permission javax.security.auth.AuthPermission "modifyPrivateCredentials";
      permission javax.security.auth.AuthPermission "setReadOnly";
      permission java.lang.RuntimePermission "setContextClassLoader";
      permission java.net.SocketPermission "*", "listen,resolve";
      permission java.lang.reflect.ReflectPermission "suppressAccessChecks";
      };</codeblock>
    <p>Replace file:/&lt;path&gt;/* with the directory where you installed the plugin. 
      For example, if you installed Elasticsearch from as a deb/rpm package on Linux, 
      this would be file:/usr/share/elasticsearch/plugins/transport-couchbase/* - 
      note the trailing *, which means that the policy will apply to all files in that directory.</p>
    <p>If you prefer to use the GUI applet, run specify the location of the policy file with the -file parameter, 
      for example:</p>
    <codeblock>sudo $JAVA_HOME/bin/policytool -file $JAVA_HOME/jre/lib/security/java.policy </codeblock>
    <p>When the applet window appears, verify that the Policy File textbox shows the name of 
      the policy file you're going to edit. To add the required security settings click on the 
      "Add Policy Entry" button. In the new "Policy Entry" window that will appear, fill in the 
      CodeBase textbox with the URL path to the plugin's installation directory, as explained above. 
      Next, add each of the following permissions 
      by clicking on the "Add Permission" button for each, then selecting the specified options:</p>
    <codeblock>1.)  permission javax.security.auth.AuthPermission "modifyPrincipals";
      
      From the "Permission:" dropdown select:
      
      AuthPermission
      
      From the "Target Name:" dropdown select:
      
      modifyPrincipals
      
      Click "Ok"
      
      2.)  permission javax.security.auth.AuthPermission "modifyPrivateCredentials";
      
      From the "Permission:" dropdown select:
      
      AuthPermission
      
      From the "Target Name:" dropdown select:
      
      modifyPrivateCredentials
      
      Click "Ok"
      
      3.)  permission javax.security.auth.AuthPermission "setReadOnly";
      
      From the "Permission:" dropdown select:
      
      AuthPermission
      
      From the "Target Name:" dropdown select:
      
      setReadOnly
      
      Click "Ok"
      
      4.)  permission java.lang.RuntimePermission "setContextClassLoader";
      
      From the "Permission:" dropdown select:
      
      RuntimePermission
      
      From the "Target Name:" dropdown select:
      
      setContextClassLoader
      
      Click "Ok"
      
      5.)  permission java.net.SocketPermission "*", "listen,resolve";
      
      From the "Permission:" dropdown select:
      
      SocketPermission
      
      In the "Target Name:" textbox type:
      
      *
      
      In the "Actions:" dropdown type:
      
      listen,resolve
      
      Click "Ok"
      
      6.)  permission "java.lang.reflect.ReflectPermission" "suppressAccessChecks";
      
      From the "Permission:" dropdown select:
      
      ReflectPermission
      
      From the "Target Name:" dropdown select:
      
      suppressAccessChecks
      
      Click "Ok"
    </codeblock> 
    <p>At the end of the process, your policy tool should look similar to this:</p>
    <p><image href="images/es-java-policy.png" id="image_qkd_41r_t5" align="left" width="720"/></p>
    <p>Click <uicontrol>Done</uicontrol> to close the <wintitle>Policy Entry</wintitle> window and then select 
      <uicontrol>Save</uicontrol> from the File menu of the Policy Tool window. 
      Close the policy tool utility when you're finished.</p>
    
  </body>
</topic>
