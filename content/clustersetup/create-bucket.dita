<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="topic_fym_kmn_vs">
  
  <title>
    Create a New Bucket
  </title>
  
  <shortdesc>
    <i>Full</i> and <i>Cluster</i> Administrators can use the Couchbase Web Console, CLI, or
    REST API to create a new bucket.
  </shortdesc>
  
  <body>
    
   <section>
     <title>
       Create a Bucket using the Couchbase Web Console
     </title>
     
    <p>
      Access the Couchbase Web Console, and left-click on the <uicontrol>Buckets</uicontrol> tab, in the
      vertical navigation-bar at the left-hand side:
    </p>
     
     <p>
       <image href="./picts/accessBucketTab.png" id="access_bucket_tab" align="left" width="100"/>
     </p>
     
     <p>
       The <uicontrol>Buckets</uicontrol> screen now appears, showing the buckets that have already been
       defined for your system:
     </p>
     
     <p>
       <image href="./picts/bucketsViewInitial.png" id="buckets_view_initial" align="left" width="880"/>
     </p>
     
     <p>
       To create a new bucket, left-click on the <uicontrol>+ Add Data Bucket</uicontrol> button, at the
       upper-right:
     </p>
     
     <p>
       <image href="./picts/addDataBucketButton.png" id="add-data-bucket-button" align="left" width="170"/>
     </p>
     
     <p>
       This brings up the <uicontrol>+ Add Data Bucket</uicontrol> dialog, which appears as follows:
     </p>
     
     <p>
       <image href="./picts/addDataBucketDialogInitial.png" id="add-data-bucket-dialog-initial" align="left" width="320"/>
     </p>
     
     <p conref="../security/security-create-bucket-for-access-testing.dita#rbac-hint-for-bucket-creation">Note on hint on dialog.</p>
     
     <p>
       Enter a bucket-name into the interactive <uicontrol>Name</uicontrol> text-field. A bucket name can only 
       contain characters in range A-Z, a-z, 0-9 as well as underscore,
       period, dash and percent and can be a maximum of 100 characters in length. 
     </p>
     
     <p>
       The <uicontrol>Access Control</uicontrol> checkbox is selected by default, ensuring that the bucket you
       create will be protected by SASL-authentication. This also means that you must specify a password, which
       will need to be provided by all administrators and programs attempting access. Enter an appropriate
       password into the interactive <uicontrol>Enter password</uicontrol> text field. For best practices on
       password-design, see
       <xref href="../security/security-passwords.dita" scope="local" format="dita">Couchbase Passwords</xref>.
       (Note that an alternative to SASL-authentication is described below.)
     </p>
     
     <p>
       Specify an appropriate memory quota for your bucket, in the <uicontrol>Memory Quota</uicontrol> field: 
       either enter a figure directly from the keyboard, or use the arrow-icons at the right-hand side of the interactive
       text-field to modify the suggested figure. The quota you specify is allocated for your bucket on a per node basis. 
       The value you enter must fit with the overall cluster RAM quota. The cluster quota is displayed as a figure; and
       also graphically, as horizontal display-bar. The bar indicates the relative sizes of the quota you are adding 
       for the bucket you are creating, the amount of memory already added to other buckets, and the amount
       currently free.
     </p>
     
     <p>
       You will now proceed to establish <i>advanced settings</i> for your bucket.
     </p>

   </section>
    
    <section>
      
      <title>
        Establish Advanced Bucket Settings
      </title>
      
      <p>
        Left-click on the <uicontrol>Show advanced bucket settings</uicontrol> tab. This causes the <uicontrol>+ Add
        Data Bucket</uicontrol> dialog to expand vertically, and display additional information, as follows:
      </p>
      
      <p>
        <image href="./picts/addDataBucketDialogExpanded.png" id="add-data-bucket-dialog-expanded" align="left" width="350"/>
      </p>
      
      <p>
        The newly displayed panels are as follows:
      </p>
      
      <ul>
        
        <li>
          <uicontrol>Bucket Type</uicontrol>
          
          <p>
            Offers three bucket-types from which to choose: <uicontrol>Couchbase</uicontrol>,
            <uicontrol>Memcached</uicontrol>, and <uicontrol>Ephemeral</uicontrol>. For information on the differences between
            these bucket-types, see
            <xref href="../architecture/core-data-access-buckets.dita#couchbase-bucket-types" scope="local" format="dita">Buckets</xref>. 
          </p>
          
          <p>
            Note that if you select <uicontrol>Memcached</uicontrol>, all other panels below are removed as inapplicable to your
            choice, except for <uicontrol>Access Control</uicontrol> and <uicontrol>Flush</uicontrol>.
            For now, use the default selection of <uicontrol>Couchbase</uicontrol>.
          </p>
          
          <p>
            <!-- Vertical space -->
          </p>
          
        </li>
        
        <li>
          <uicontrol>Ejection Method</uicontrol>
          
          <p>
            Provides options that vary, depending on whether your bucket type selection
            is <uicontrol>Couchbase</uicontrol> or <uicontrol>Ephemeral</uicontrol>. For information on how the options are
            displayed, see the description provided in
            <xref href="../install/init-setup.dita#ejection-method-selection" scope="local" format="dita">Initialize the Cluster</xref>.
            For more on ejection methods, see the description provided in
            <xref href="../architecture/core-data-access-buckets.dita#ejection-and-eviction-definitions" scope="local" format="dita">Buckets</xref>.
          </p>
          
          <p>
            <!-- Vertical space -->
          </p>
          
        </li>
        
        <li>
          <p conref="../install/init-setup.dita#conflict-resolution-definition-01">  
          </p>
          
          <p conref="../install/init-setup.dita#conflict-resolution-definition-02">   
          </p>
          
          <p>
            <!-- Vertical space -->
          </p>
          
        </li>
        
        <li>
        
          <p conref="../install/init-setup.dita#replicas-definition-01">   
          </p>
        
          <p conref="../install/init-setup.dita#replicas-definition-02"> 
          </p>
          
          <p conref="../install/init-setup.dita#replicas-definition-03"> 
          </p>
        
          <p>
            <!-- Vertical space -->
          </p>
        
        </li>
        
      </ul>
      
      <p>
        
      </p>
      
      
      
    </section>
    
    <section>
      <title>
        Memory Size
      </title>
      
      <p>
        In the <wintitle>Memory Size</wintitle> section, you will configure the RAM quota your
        bucket will allocate on a per node basis. The value you enter must fit with the overall
        cluster RAM quota. The cluster quota and what you are trying to add are displayed in the bar
        on the <wintitle>Setting</wintitle> page. The bucket RAM quota can be dynamically altered up
        or down with zero downtime to the cluster at any point in the future, provided you have
        enough cluster resources.
      </p>
      
      <p>
        Regarding Cache Metadata, keep in mind that it can have serious implications on your
        applicationâ€™s performance. 
      </p>
      
      <p>
        Use <term>Value ejection</term> unless you know very well what <term>Full ejection</term>
        does, why you should use it and what impacts it can have on your application and the
        operation of your database. If you use Full ejection effectively, it is very powerful and
        expands what you can do with Couchbase Server. If you use it incorrectly, it can cause
        performance problems in your application and operation of your database. Please make sure
        you read the detailed documentation on <xref
          href="../architecture/db-engine-architecture.dita#concept_b5n_bwn_vs/full-ejection"/>
        before changing this setting. 
      </p>
      
      <p>
        <image href="../admin/picts/bucket-full-ejection.png" id="image_rcx_pcs_zs" align="left"
        width="570"/>
      </p>
      
    </section>
    
    <section>
      <title>
        Access Control
      </title>
      
      <p>
        Access Control is configured using the Couchbase Web
        Console and is set for two ports: Standard port and Dedicated port:
      </p>
      
      <p>
        <image
          href="../images/admin-access-control.png" align="left" width="570"/>
      </p>
      
      More details about
      standard and dedicated ports are provided in <xref
        href="../security/security-pw-auth.dita#topic_jzr_ct2_gv/standardport"/>.
    
    </section>
    
    <section id="bucket-creation-conflict-resolution">
      
      <title>
        Conflict Resolution
      </title>
      
      <p>The conflict resolution strategy is set on a per bucket basis. It is chosen during bucket
        creation and cannot be changed. The default conflict resolution setting is 'Sequence
        number'.
      </p>
      
      <p>
        You can learn more about the two different conflict resolution strategies in <xref
          href="../xdcr/xdcr-conflict-resolution.dita"/>. If you wish to enable the timestamp-based
        conflict resolution for your existing bucket while upgrading to version 4.6.0, then you must
        migrate your data to version 4.6.0. For instructions, see <xref
          href="../install/migration.dita#topic_s2r_2yt_gy"/>.
      </p>
      
      <p>You can also set the conflict resolution method using the CLI <xref
          href="../cli/cbcli/bucket-create.dita#reference_llp_znv_sq"/> command, or the <xref
          href="../rest-api/rest-bucket-create.dita#rest-bucket-create">REST API</xref>.</p>
    </section>
    
    <image placement="break" href="../admin/picts/bucket-create-conflict-resolution-setting.png"
      width="570" id="image_ady_hfw_py"/>
    
    
    <section>
      
      <title>
        Replicas
      </title>
      
      <p>
        One replica is configured by default, even if your cluster does not yet have enough nodes
        to support replicas (minimum two nodes). 
      </p>
      
      <p>
        The general rule is to have a replica for each node that can fail in the cluster. Best
        practice is to keep at least one replica copy configured at all times and most users run
        with one replica. If you decide that more replica copies are needed for your bucket, make
        sure that you read the <xref href="../install/sizing-general.dita#topic_axp_glg_xs"
          >sizing</xref> section of Couchbase Server documentation. The more replicas you have, the
        more server and network resources are required. 
      </p>
      
      <p>
        In general, you will have one replica for clusters up to 5 data nodes, one or two replicas
        in clusters from 5 to 10 data nodes and three replicas only in clusters with 10 or more data
        nodes. 
      </p>
      
      <p>
        <image href="../admin/picts/create-replicas.png" id="image_fyn_mnv_4v" align="left"
          width="570"/>
      </p>
      
    </section>
    
    <section>
      
      <title>
        Disk I/O Optimization
      </title>
      
      <p>
        The Disk I/O setting control the disk I/O priority the bucket will get. The setting
        defaults to low priority, because if all buckets in a cluster are set to the same priority,
        then all buckets get the same disk I/O. 
      </p>
      
      <p>
        This setting only enables prioritization if at least one bucket in the cluster is set
        differently. Therefore, there is no effect if all buckets are set to high priority. If
        buckets with different priorities exist in the cluster, there are internal server resources
        allocated for high and low priority buckets. 
      </p>
      
      <p>
        <image href="../admin/picts/bucket-disk-io.png" id="image_rlt_j2s_zs" align="left"
          width="570"/>
      </p>
      
    </section>
    
    <section>
      
      <title>
        Auto-Compaction
      </title>
      
      <p>
        This setting allows you to override the cluster-wide auto-compaction settings for the
        specified bucket. 
      </p>
      <p>
        For the most part, you should never need to use this setting. 
      </p>
      
      <p>
        <image href="../admin/picts/bucket-auto-compact.png" id="image_bkg_wfs_zs" align="left"
          width="570"/>
      </p>
      
    </section>
    
    <section>
      <title>
        Flush
      </title>
      
      <p>
        This setting enables or disables the <codeph>flush</codeph> operation for the bucket and is
        disabled (unchecked) by default. Checking this option does not directly trigger the
          <codeph>flush</codeph>, it only allows a <codeph>flush</codeph> to be triggered.
      </p>
      
      <p>
        It is recommended that the <codeph>flush</codeph> capability is disabled in production as
        it irreversibly deletes every document in the bucket. Even for use cases where this is the
        desired behaviour, flushing is not recommended as it is a very disruptive process.
      </p>
      
      <p>
        <image href="../admin/picts/bucket-flush.png" id="image_b5v_pfs_zs" align="left"
          width="250"/>
      </p>
      
      <p>
        You can flush a bucket <xref href="bucket-flush.dita">using the UI</xref> or using the CLI command <xref
          href="../cli/cbcli/bucket-flush.dita#cbcli-bucket-flush">bucket-flush</xref> and REST API
          <xref href="../rest-api/rest-bucket-flush.dita#rest-bucket-flush"
          >rest-bucket-flush.</xref>
      </p>
      
    </section>
    
    <section>
      <title>
        Bucket Creation Status Update
      </title>
      
      <p>
        After the bucket creation is completed, you can get the status update as follows: 
        
        <ul>
          
        <li>
          Send a GET or any other command to the memcached on the created bucket. If you receive
          the response <codeph>ETMPFAIL</codeph>, try the command later.
        </li>
          
        <li>
          Monitor the ep-engine bucket stats on one of the nodes. The bucket is created when the
          stat <codeph>ep_degraded_mode</codeph> changes from <codeph>true</codeph> to
          <codeph>false</codeph>.
        </li>
          
        <li>
          Monitor <filepath>/pools/default/buckets/&lt;bucketname&gt;</filepath> or
          <filepath>/pools/default/bucketsStreaming/&lt;bucketname&gt;</filepath>. The bucket is
          created when all node statuses turn from <codeph>warmup</codeph> to
          <codeph>healthy</codeph>.
        </li>
          
      </ul>
      
      </p>
      
    </section>
    
    <section>
      <title>
        Create a New Bucket with CLI or REST API
      </title>
      
      <p>
        You can also use the Couchbase Server CLI command <xref
        href="../cli/cbcli/bucket-create.dita#reference_llp_znv_sq">bucket-create</xref> or REST
        API command <xref href="../rest-api/rest-bucket-create.dita#rest-bucket-create"
          >rest-bucket-create</xref>.
      </p> 
      
    </section>
    
  </body>
  
  <related-links>
    <link href="../security/concepts-rba.dita#concept_ntl_jph_hr"/>
  </related-links>
</topic>
