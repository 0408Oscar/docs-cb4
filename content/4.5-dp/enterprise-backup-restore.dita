<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="topic_rr5_sv3_t5">
  <title>Enterprise grade Backup and Restore tool</title><shortdesc>Couchbase Server 4.5 provides a new enterprise-grade Backup and Restore tool that can
    back up larger data sets with much higher performance.</shortdesc>
  <body>
  <section><title>About the Backup and Restore tool</title>
    <p>The backup and restore capabilities are critical to ensuring disaster recovery and business
        continuity. The scalable, high-performant Backup and Restore tool allows Couchbase Server to
        provide faster recovery with better <xref
          href="https://en.wikipedia.org/wiki/Recovery_time_objective" format="html"
          scope="external">Recovery Time Objective</xref> (RTO) and <xref
          href="https://en.wikipedia.org/wiki/Recovery_point_objective" format="html"
          scope="external">Recovery Point Objective</xref> (RPO). </p>
    <p>Data is the most important asset for any business or organization. Our new enterprise- grade
        backup and restore tool delivers the most robust data protection and provides the user with
        peace of mind and confidence that their mission critical databases are fully protected. </p> 
    
    <p>In general, backups are part of an overall Disaster Recovery plan. For your applications and
        services, it is best to establish a documented Recovery Time Objective (RTO) and Recovery
        Point Objective (RPO) as part of that plan. If you are not familiar with these terms, it is
        recommended that you learn how backup and recovery fit as part of an overall Disaster
        Recovery plan. </p> 
    
    <p>The Backup and Restore tool is a utility to help manage and store backup and recovery data on
        disk for your Couchbase Server. It backs up and restores bucket data, views creation
        scripts, index creation scripts, bucket configurations, and so on. Backups are stored in an
        Archive Repository that contains each backup. </p>
      <p>Each backup job stores data in two ways: <ul id="ul_m4b_x5f_z5">
          <li>All bucket data in a secondary smaller database (<xref
              href="applewebdata://6B1602CB-44DE-4510-BEA0-96F5CA06543C/link" format="html"
              scope="external">ForestDB</xref>).</li>
          <li>Creation scripts and configurations as files on the file system.</li>
        </ul> All backups are stored in and recovered from an <term>Archive Repository.</term>
      </p> 
    
    <note type="important">The Backup and Restore tool is not backward compatible for backups made
        with <cmdname>cbbackup</cmdname>.</note> 
    <p>The tool is installed with all other tools in the following locations on each platform: </p>
    <p>
      <table frame="all" rowsep="1" colsep="1" id="table_a34_jpf_z5">
        <title>Backup tool locations</title>
        <tgroup cols="2">
          <colspec colname="c1" colnum="1" colwidth="1*"/>
          <colspec colname="c2" colnum="2" colwidth="5*"/>
          <thead>
            <row>
              <entry>Operating system</entry>
              <entry>Directory locations</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>Linux</entry>
              <entry><filepath>/opt/couchbase/bin</filepath>
                <p><filepath>/opt/couchbase/bin/install</filepath></p>
                <p><filepath>/opt/couchbase/bin/tools</filepath></p></entry>
            </row>
            <row>
              <entry>Windows</entry>
              <entry><filepath>C:\Program Files\couchbase\server\bin</filepath>
                <p><filepath>C:\Program Files\couchbase\server\bin\install</filepath>
                </p>
                <p><filepath>C:\Program Files\couchbase\server\bin\tools</filepath></p></entry>
            </row>
            <row>
              <entry>Mac OS X</entry>
              <entry><filepath>/Applications/Couchbase
                  Server.app/Contents/Resources/couchbase-core/bin</filepath>
                <p><filepath>/Applications/Couchbase
                    Server.app/Contents/Resources/couchbase-core/bin/tools</filepath></p>
                <p><filepath>/Applications/Couchbase
                    Server.app/Contents/Resources/couchbasecore/bin/install</filepath></p></entry>
            </row>
          </tbody>
        </tgroup>
      </table>
    </p>
  </section>
    
  <section><title>How the tool works</title>
    <p>By default, the Backup and Restore tool performs incremental backups to back up only the new data. However, on a new 
      cluster and for the first time this tool will produce a full backup. Each of the subsequent 
      incremental backups will take a fraction of the time needed for the full backup. </p>
    <note type="note">Only the full Couchbase administrators can use the Backup and Restore tool to
      back up and restore data.</note> 
    
    
  </section>
    <section><title>Sample one bucket backup</title>
      
      <p>Here are the steps to follow to perform a simple, quick backup of a specific bucket across
        all nodes of the cluster.</p>
      <p>The examples are to a server on localhost, but they could be to a remote cluster. Like a
        Couchbase SDK, provide at least one node of the cluster and the <cmdname>backup</cmdname>
        command will then get the cluster map. That will allow you to learn how to access the other
        nodes in the cluster.</p>
      <dl>
        <dlentry>
          <dt>Create an archive repository with the command <cmdname>create</cmdname>:</dt>
          <dd>It is required that each archive has a directory path to store the backups and a name
            to refer to it.</dd>
          <dd><p>On Linux and Mac OS:
              <codeblock>$> ./backup create --name=travel --dir=/data/couchbase/backups </codeblock></p>
          <p>On Windows:
              <codeblock>C:\> backup create --name=travel --dir=E:\data\couchbase\backups</codeblock></p></dd>
          <dd>This creates a backup directory named <codeph>travel</codeph>. If this directory does
            not exist, the backup tool will attempt to create it. </dd>
        </dlentry></dl>
      
      <dl>
        <dlentry>
          <dt>Back up the bucket with the command <cmdname>cluster</cmdname>:</dt>    
          <dd>
            <p>On Linux and Mac OS:
              <codeblock>$> ./backup cluster --dir /data/couchbase/backups --host couchbase://<varname>localhost</varname> \
--username <varname>MyAdminUsername</varname> --password <varname>MyAdminPassword</varname> --name travel-sample</codeblock></p>
            <p>On Windows:
              <codeblock>C:\> backup cluster --dir=C:\data\couchbase\backups\travel --host couchbase://<varname>localhost</varname> \
--username <varname>MyAdminUsername</varname> --password <varname>MyAdminPassword</varname> --name=travel-sample</codeblock></p>
          </dd>
          <dd>The output of these commands will look similar to the following: <p><image
            href="pict/backup-output.png" id="image_hqm_kmb_y5"/>
          </p></dd>
          <dd>The duration and size of your backups will vary of course.</dd></dlentry></dl>
    
      <dl>
        <dlentry>
          <dt>Restore the bucket data with the command <cmdname>restore</cmdname></dt>
          <dd>Here are the steps to do a restore operation on a cluster.</dd>
          <dd>
            <p>On Linux and Mac OS:
              <codeblock>$> ./backup restore  restore --dir=/data/couchbase/backups/travel --host couchbase://<varname>localhost</varname> \
--username <varname>MyAdminUsername</varname> --password <varname>MyAdminPassword</varname> --name=travel-sample</codeblock></p>
            <p>On Windows:
              <codeblock>C:\> backup restore --dir C:\data\couchbase\backups\travel --host couchbase://<varname>localhost</varname> \
--username <varname>MyAdminUsername</varname> --password <varname>MyAdminPassword</varname> --name=travel-sampl</codeblock></p>
          </dd>
        </dlentry>
      </dl>
     
      
      
    </section>
    
    
    
    
  
    
    <section><title>Archive repository</title>
    <p>The backup archive is a directory that contains a set of backup repositories as well as logs
        for the backup client. The backup directory should be modified only by the backup client,
        and any modifications that are not done by that client might result in a corruption of
        backup data. </p>
    <p>Only one backup client can access the backup archive at one time. If multiple instances of
        the backup client are running on the same archive at the same time, this might result in
        corruption. To prevent such corruption instances, you may be required to create multiple
        backup archives depending on your use case. </p></section> 
    
    
   
  
  </body>
</topic>
