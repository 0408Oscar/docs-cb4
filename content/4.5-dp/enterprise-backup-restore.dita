<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="topic_rr5_sv3_t5">
  <title>Enterprise Backup and Restore service</title><shortdesc>The <codeph>cbbackup</codeph> tool remains available both for the Community
    and Enterprise editions of Couchbase Server, but the new <term>Backup and Restore
      service</term> will be supported only for Couchbase Server Enterprise Edition.</shortdesc>
  <body>
  
    <p>The <xref
      href="http://developer.couchbase.com/documentation/server/4.1/cli/cbbackup-tool.html"
      format="html" scope="external">cbbackup</xref> tool enables you to back up a single node, a single bucket or
      the entire cluster into a flexible backup structure, which can restore the data into the same,
      or different, clusters and buckets. While <cmdname>cbbackup</cmdname> tool, combined with the
        <xref
        href="http://developer.couchbase.com/documentation/server/4.1/backup-restore/restore-cbrestore.html"
        format="html" scope="external">cbrestore</xref> tool, offers an easy and flexible solution
      to handle data including incremental backups, the new service is more convenient and efficient
      when handling large, multiple GB of data. </p>
    <p>By default, the Backup and Restore service performs incremental backups to back up only the
      new data. However, on a new cluster and for the first time this tool will produce a full
      backup. Each of the subsequent incremental backups will take a fraction of the time needed for
      the full backup.</p>
    
    <p>Backups are part of an overall Disaster Recovery Plan. For your applications and services, it
      is best to establish the <xref href="https://en.wikipedia.org/wiki/Recovery_time_objective"
        format="html" scope="external">Recovery Time Objective</xref> (RTO) and <xref
        href="https://en.wikipedia.org/wiki/Recovery_point_objective" format="html" scope="external"
        >Recovery Point Objective</xref> (RPO) periods as part of that plan. It is recommended that
      you familiarize yourself with how backups fit as a part of an overall Disaster Recovery Plan. </p>
    <note type="note">Only the full Couchbase administrators can use the Backup and Restore service to back up
      and restore data.</note>
    
    <section><title>Backup archive</title>
    <p>The backup archive is a directory that contains a set of backup repositories as well as logs
        for the backup client. The backup directory should be modified only by the backup client,
        and any modifications that are not done by that client might result in a corruption of
        backup data. </p>
    <p>Only one backup client can access the backup archive at one time. If multiple instances of
        the backup client are running on the same archive at the same time, this might result in
        corruption. To prevent such corruption instances, you may be required to create multiple
        backup archives depending on your use case. </p></section> 
    <section><title>How the Backup and Restore service works</title>
    <p>The Backup and Restore service is installed as a part of the Couchbase Server Enterprise Edition package.</p>
      
      <p>Here are the steps to follow to perform a simple quick backup of a specific bucket across all nodes of the cluster:</p> 
      <dl>
        <dlentry>
          <dt>Create an archive repository with the command <cmdname>create</cmdname>:</dt>
          <dd>If that directory does not exist, the backup utility will attempt to create it:
            <codeblock>./backup create --dir=[directory-name] --name=[repository-name] --host=[hostname] \
--username [admin] --password [password]</codeblock></dd>
        </dlentry></dl>
        
      <dl>
        <dlentry>
          <dt>Back up a bucket with the command <cmdname>cluster</cmdname>:</dt>    
           <dd>Only full Couchbase administrators can perform backups using their credentials. <p>On
              Linux and Mac OS:
              <codeblock>$> ./backup cluster --dir=/tmp/backups --name=travel --host=http://localhost:8091 \
--username=MyAdminUsername --password=MyAdminPassword </codeblock></p><p>On
              Windows:
              <codeblock>C:\> backup cluster --dir=C:\tmp\backups\travel --name=travel --host=http://localhost:8091 \
--username=MyAdminUsername --password=MyAdminPassword</codeblock></p></dd>
       <dd>The output of these commands will look similar to the following: <p><image
                href="pict/backup-output.png" id="image_hqm_kmb_y5"/>
            </p></dd></dlentry></dl>
      
      <dl>
        <dlentry>
          <dt>Restore data with the command <cmdname>restore</cmdname></dt>
          <dd>Only full Couchbase administrators can perform restores using their credentials. 
            To restore all backups in the backup repository <codeph>travel</codeph>: 
            <p>On Linux and Mac OS:
            <codeblock>$> ./backup restore --dir=/tmp/backups/travel --name=travel-sample --host=http://localhost:8091 \
 --username=MyAdminUsername --password=MyAdminPassword </codeblock></p><p>On
                Windows:
              <codeblock>C:\> backup restore --dir=C:\tmp\backups\travel --name=travel-sample --host=http://localhost:8091 \
--username=MyAdminUsername --password=MyAdminPassword </codeblock></p></dd>
        </dlentry>
      </dl>
      
      
      
      
    </section>
   <!--
    
    <section><title>Backup limitations</title>
     
      <p>Couchbase Server backs up all the data up to the high sequence number of each VBucket. </p>
     
      <p><image href="pict/BR-service.png" id="image_bdw_4tl_55" align="left" width="400"/></p>
      <p>The amount of time needed for a backup depends on the network card bandwidth  (3) or the
        disk bandwidth on a particular node (4). </p>
    
      <dl>
        <dlentry>
          <dt>Type of backed up data</dt>
          <dd>You can choose what kind of data you want to back up, such as: <ul>
              <li>Cluster or bucket configuration </li>
              <li>Views definitions</li>
              <li>GSI definitions </li>
              <li>Data</li>
            </ul></dd>
        </dlentry>
      </dl>
      <dl>
        <dlentry>
          <dt>Backup workflow</dt>
          <dd>Once you decide what to back up, you can create a backup set and name it. Then, when
            you run this service, you provide the backup set name, and the backup process will start
            where the last backup in the set left off. </dd>
          <dd>Each backup timeline has a name, and each backup occurrence has a timestamp value. </dd>
          <dd>Backups are captured in backup logs.</dd>
        </dlentry>
      </dl> 
    
  </section>
    <section><title>Restore</title>
   <p>To restore the backed up data, specify a range of backups within the backup set using the
        start and end timestamp. You can also use a command to list the backups within the backup
        set to figure out the start and end timestamp.  </p>
     
      <dl>
        <dlentry>
          <dt>Restore granularity</dt>
          <dd>When restoring the backed-up data, you can choose whether to restore: <ul>
              <li>An entire backup timeline:<ul>
                  <li>Restore the full backup of a whole cluster</li>
                  <li> Restore the full backup of a whole bucket</li>
                </ul></li>
              <li>A backup timeline between particular start and end timestamp values: <ul>
                  <li>full backup of an entire cluster</li>
                  <li>full backup of an entire bucket</li>
                  <li>an incremental backup to a particular backup occurrence timestamp </li>
                </ul></li>
              <li>Specified bucket objects.</li>
            </ul></dd>
          
        </dlentry>
      </dl>
      
      
      
    </section>
   -->
  </body>
</topic>
