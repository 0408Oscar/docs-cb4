<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="topic_vqb_p2n_s5">
  <title>Using REST</title>
 
  <shortdesc>Couchbase Server usees REST APIs to manage X.509 certificates.</shortdesc>
  <body>
     <section><title>GET/pools/default/certificate</title><p><b>Description</b></p>Returns current
      Cluster CA. With the parameter <codeph>extended=true</codeph> returns extended certificate
      info:
          <codeblock>{"cert": {"type" : ..., "pem" : ..., "subject" : ..., "expires" : ...}, warnings: []} </codeblock><p><b>Parameters</b></p><ul>
        <li><codeph>type</codeph> - generated or uploaded</li>
        <li><codeph>pem</codeph> - pem encoded certificate</li>
        <li><codeph>subject</codeph> - abbreviated certificate subject (*)</li>
        <li><codeph>expires</codeph> - expiration data (*)</li>
        <li><codeph>warnings</codeph> - warnings to be displayed in UI </li>
      </ul><p>(*) not available for generated certificates </p><p><b>Example</b></p><codeblock>$ curl -X GET http://user:password@127.0.0.1:9000/pools/default/
        certificate?extended=true</codeblock><codeblock>{"cert":{"type":"uploaded","pem":"-----BEGIN CERTIFICATE-----
         \nMIIC6DCCAdKgAwIBAgIIFB4YAjF90MgwCwYJKoZIhvcNAQELMBkxFzAVBgNVBAMT\
         nDlJvb3QgQXV0aG9yaXR5MB4XDTEzMDEwMTAwMDAwMFoXDTQ5MTIzMTIzNTk1OVow\
         nGTEXMBUGA1UEAxMOUm9vdCBBdXRob3JpdHkwggEiMA0GCSqGSIb3DQEBAQUAA4IB\
         nDwAwggEKAoIBAQDBum06stdiYQI2HQyjZeg3s0Pz8CziXqSg4GicaeKNloOfASwl\
         n+8LQDX5Dgb+Mc4ZxXYo9/7eVlsvSiZPZcv9D2pubjR4ZtEDY5t9AlXDiYTHK0zxG\
         nB34Llnz3gJmkAEAsjy4g+RfwpJS4kGVzFhrzgxOQJIJogZnLduk+mHFjyXI3X+8y\
         nf4KF8ijrXP8bbfa0kM1tjvcttaK7vTEP+G/mbOEFZErhScXT9eKRlgwsitaH7kI0\
         nimpqg3YX1znLQ5n+eLzeVR1HhszJrFaaaRHL0esml6jLEcZBBitJSuEuaMLp9ZWB\
         nA479ZHmN/vZc1SwfMrCE2+TE0ytW3O7eFXjXAgMBAAGjODA2MA4GA1UdDwEB/wQE\
         nAwIApDATBgNVHSUEDDAKBggrBgEFBQcDATAPBgNVHRMBAf8EBTADAQH/MAsGCSqG\
         nSIb3DQEBCwOCAQEACReNkvIXhjPO0rWpgdVSqnLrjUb6DJf0n4Uyq6PfukeEfBtF\
         n59L+xUcoY6NFM5N6qRlGgg0eqTCVmQ6N6lKnnZRH23g3BPLjU2EqAtBHIc5f2JoM\
         nd1E4UD2v20MlFoeHL0YljGTywlqStoZYc2uYUJnJAVq2D1dWcwP2S7G6caLHMlAl\
         nQVYIZvjCGuqGckV1EqOTT7uKPH9ulljtYKVIq/aTbINjX0hJsaoN2hOfHVTp2Shq\
         neLMwgfNdg6zWRyeL/Mi/3jmSjSH61zyHva2xlY8Pl6Zurx/+pF1qN27+P8tCjsDO\
         nD2hAADXr8WRqC1Sd+xAGcFkvqOOFv/HRxDej3A==\
         n-----END CERTIFICATE-----\n",
         "subject":"CN=Root Authority","expires":"2049-12-31T15:59:59.000Z"},
         "warnings":[{"node":"n_0@127.0.0.1","message":
         "Certificate is not signed with cluster CA."}]} </codeblock>
      <p><b>Possible
      warnings:</b></p><codeblock>{"node":"n_0@127.0.0.1","message":"Certificate is not signed with cluster CA."}</codeblock><codeblock>{"node":"n_0@127.0.0.1","message":"Certificate is expired."}</codeblock><codeblock>{"node":"n_0@127.0.0.1","message":"Certificate will expire soon.","expires":"2049-12-31T15:59:59.000Z"}</codeblock>
    </section>
  
    <section><title>POST/controller/uploadClusterCA</title><p><b>Description</b></p>Uploads pem
      encoded root certificate (Cluster CA) to the cluster. That certificate will be displayed in UI
      and used for XDCR replications and for clients certificate stores. <p><b>Example</b>
      </p><codeblock>curl -X POST --data-binary "@/path/root.pem" http://user:password@127.0.0.1:9000/controller/uploadClusterCA </codeblock><p><b>Returns</b></p><p>Same
        output as <codeph>GET/pools/default/certificate?extended=true</codeph>
      </p></section>
      
    <section>
      <title>POST /node/controller/reloadCertificate</title>
      <p><b>Description</b></p>
      <p>Grabs <codeph>chain.pem</codeph> and <codeph>pkey.pem</codeph> from the <filepath>&lt;data
          folder>/inbox/</filepath> directory and applies them to the node.</p>
      
      <p><b>Parameters</b></p>
      <ul>
        <li><codeph>chain.pem</codeph> - Contains a chain of pem-encoded certificates starting from
          the node certificate and ending with the last intermediate certificate that precedes the
          cluster certificate.</li>
        <li><codeph>pkey.pem</codeph> - Contains the pem-encoded private key for the node
          certificate.</li>
        
      </ul>
      <p><b>Example</b></p>
      <codeblock>curl -X POST http://user:password@127.0.0.1:9000/node/controller/reloadCertificate</codeblock>
      <p><b>Returns</b></p>
      <ul>
        <li><codeph>200</codeph> - If it is a success
        </li>
        <li><codeph>400</codeph> - An  error message if it failed.</li>       
      </ul>   
    </section> 
    <section>
      <title>GET /pools/default/certificate/node/&lt;host:port></title>
      <p><b>Description</b>Retrieves information about the uploaded node certificate.</p>
      <p><b>Example</b>
      </p>
      <codeblock>$ curl -X GET http://user:password@127.0.0.1:9000/pools/default/certificate/node/127.0.0.1:9000
        {"subject":"CN=127.0.0.1","expires":"2049-12-31T15:59:59.000Z","pem":"
        -----BEGIN CERTIFICATE-----\nMIIC+DCCAeKgAwIBAgIIFB4b2mfRLHcwCwYJKoZIhvcNAQELMCAxHjAcBgNVBAMT\
        nFUludGVtZWRpYXRlIEF1dGhvcml0eTAeFw0xMzAxMDEwMDAwMDBaFw00OTEyMzEy\
        nMzU5NTlaMBQxEjAQBgNVBAMTCTEyNy4wLjAuMTCCASIwDQYJKoZIhvcNAQEBBQAD\
        nggEPADCCAQoCggEBAOO9byay0UjHI4Q1dd4zMgGPc7FkGDaH/5PEj7PdjlnZC6zm\
        ncsjqAyAq9WzI+LAzzfZXm2Da8MwJZX/MsvEcG15CV8bK075D1G4R7B+E+OIG//Xl\
        ntKZe7J0YqsW5KwZlDHWkyJ06ylWl/6hvw3YkG7mUOKi5WWuj8NGHP24cImkaon4+\
        nf8D6t3vEWFQEwb8IMUDgzwdihXdSqdzQ3a9ECKbl2BKeEFbPrzWoIYjWF5dyrZg3\
        n4/3+SHZ+uZzlG2x6cL2lrs7WUJXseasjkSFuQQzLZPIcJlJxlwXhKvfvucbgT9rG\
        nwopcjS3SaXnmreKF3jLmQGAPHYb8X1yCTTBQVLcCAwEAAaNGMEQwDgYDVR0PAQH\
        nBAQDAgCgMBMGA1UdJQQMMAoGCCsGAQUFBwMBMAwGA1UdEwEB/wQCMAAwDwYDVR0R\
        nBAgwBocEfwAAATALBgkqhkiG9w0BAQsDggEBAEEWcC8uJ/Zk/4UFYTrQyvds/Kj8\
        n8/SNWVIcMNLHNsxPGtbrsRa9VFjPlCEB+dPpgIFq08626zRQ2Lb1qRZGWj+YM5gC\
        nhxaERSURrvr6i8x9jwALkQUxitRkNP6cb+wi4BCn8qjgxxyZ4g+CHEO9pHceljIn\
        n/bwY+hHTG0a+8hVj/14TGExFrEzNhyeSMmGpdFq3PNT97gRuVvFAz6ZD8qAt+S0j\
        nT61oShOpwNwhWnkK3OynN2JdVT+G496/xRayDPXG40V/AkJs3udZ6QmoeifkJ8sj\
        nYgOxdPWLMnAJ7fw6l/XE7XVD/Jld+pJrFa4YqHBkWL+s20OQmuWs8dVgVQ0=\n
        -----END CERTIFICATE-----\n\n"}</codeblock>
    </section>
  </body> 
  
</topic>
