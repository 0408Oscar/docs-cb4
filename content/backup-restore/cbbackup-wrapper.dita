<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="topic_r3f_422_dt">
  <title>Backing up using <cmdname>cbbackupwrapper</cmdname> and
    <cmdname>cbrestorewrapper</cmdname></title>
  <body>
    <p>For enterprise customers, two new tools are included with Couchbase Server Enterprise Edition
      that improve throughput for the database backup process. For now, they should be used instead
      of the standard backup tools, <xref href="../cli/cbbackup-tool.dita#cbbackup-tool"
        >cbbackup</xref> and <xref href="../cli/cbrestore-tool.dita#cdbrestore-tool"
        >cbrestore</xref>. </p>
      <p>The new tools, <cmdname>cbbackupwrapper</cmdname> and <cmdname>cbrestorewrapper</cmdname>,
      were created to specifically address the single worker thread limitation for one
      backup/restore target (Bucket, Node). </p>
    <p><cmdname>cbbackupwrapper</cmdname> and <cmdname>cbrestorewrapper</cmdname> are designed to
      provide a parallel processing approach to backing up a Couchbase Server cluster. At a
      technical level, they divide each vBucket space into a subset of vBuckets for each backup
      process and thus improve the speed and efficiency.</p>
    <note type="important">In a future release of Couchbase Server, these two tools will be folded into <cmdname>cbbackup</cmdname> 
      and <cmdname>cbrestore</cmdname> respectively and then deprecated.</note>
    <section><title>Use of
      <cmdname>cbbackupwrapper</cmdname></title><codeblock>
 $ ./cbbackupwrapper -h
Usage: cbbackupwrapper CLUSTER BACKUPDIR OPTIONS
Options:
-h, --help                                            show this help message and exit
-b BUCKET_SOURCE, --bucket-source=BUCKET_SOURCE       Specify the bucket to backup.  Defaults to all buckets
--single-node                                         use a single server node from the source only
-u USERNAME, --username=USERNAME                      REST username for source cluster or server node. Default is Administrator
-p PASSWORD, --password=PASSWORD                      REST password for source cluster or server node.
-s, --ssl                                             Transfer data with SSL enabled
-v, --verbose                                         Enable verbose messaging
--path=PATH                                           Specify the path to cbbackup. Defaults to current directory
--port=PORT                                           Specify the bucket port.  Defaults to 11210
-n NUMBER, --number=NUMBER                            Specify the number of vbuckets per process. Defaults to 100.
-P PARALLELISM, --parallelism=PARALLELISM             Number of vbucket backup jobs to run at a time. Defaults to 1.
-x EXTRA, --extra=EXTRA                               Provide extra, uncommon config parameters; comma-separated key=val(,key=val)* pairs
-m MODE, --mode=MODE                                  Backup mode: full, diff or accu [default:diff]</codeblock>
      Available extra config parameters (-x): <ul>
        <li>backoff_cap=10 (Max backoff time during rebalance period)</li>
        <li>batch_max_bytes=400000 (Transfer this # of bytes per batch)</li>
        <li>batch_max_size=1000 (Transfer this # of documents per batch)</li>
        <li>cbb_max_mb=100000 (Split backup file on destination cluster if it exceeds MB)</li>
        <li>data_only=0 (For value 1, only transfer data from a backup file or cluster)</li>
        <li>design_doc_only=0 (For value 1, transfer design documents only from a backup file or
          cluster)</li>
        <li>max_retry=10 (Max number of sequential retries if transfer fails)</li>
        <li>recv_min_bytes=4096 (Amount of bytes for every TCP/IP call transferred)</li>
        <li>rehash=0 (For value 1, rehash the partition id's of each item; this is needed when
          transferring data between clusters with different number of partitions, such as when
          transferring data from an OSX server to a non-OSX cluster)</li>
        <li>report=5 (Number batches transferred before updating progress bar in console)</li>
        <li>report_full=2000 (Number batches transferred before emitting progress information in
          console)</li>
        <li>seqno=0 (By default, start seqno from beginning.)</li>
      </ul>
    </section>  

  </body>
</topic>
